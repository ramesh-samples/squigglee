- hosts: localhost
  connection: local
  gather_facts: False    
  tasks:
    - name: Refresh dynamic inventory cache 
      local_action: command python hosts/ec2.py --refresh-cache
#    - name: Refresh seed list
#      local_action: shell python hosts/ec2.py --list | python seeds.py {{cluster}}
- hosts: tag_is_bootstrap_node_yes:&tag_cluster_{{cluster}} 
  user: ec2-user 
  vars:
    jboss_version: "jboss-as-7.1.1.Final"
#    zk_version: "zookeeper-3.4.6"
    zk_version: "zookeeper-3.5.0-alpha"
    ec2_access_key: "AKIAIQWKLMSGKA7YCSLA"
    ec2_secret_key: "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"
    cluster: "TSR_EC2_CLUST"
  tasks: 
    - command: sudo easy_install pip 
#    - command: sudo pip install ansible paramiko PyYAML Jinja2 httplib2  
    - command: sudo /usr/local/bin/pip install ansible 
    - copy: src="./ssh_config_master" dest="/home/ec2-user/.ssh/config" force="yes" owner="ec2-user" group="ec2-user" mode="0400" 
#    - copy: src="~/.ssh/awtsrclient.pem" dest="/home/ec2-user/.ssh" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
#    - copy: src="~/.ssh/awtsrserver.pem" dest="/home/ec2-user/.ssh" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="~/.ssh/ec2tsrclient_rsa" dest="/home/ec2-user/.ssh" force="yes" owner="ec2-user" group="ec2-user" mode="0400" 
    - copy: src="~/.ssh/ec2tsrserver_rsa" dest="/home/ec2-user/.ssh" force="yes" owner="ec2-user" group="ec2-user" mode="0400" 
#    - copy: src="~/.ssh/config" dest="/home/ec2-user/.ssh" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 

    - copy: src="./hosts" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0400"      
    - file: path=/home/ec2-user/ansible/hosts/ec2.py state=touch mode="0700"
    - copy: src="./ansible_hosts_master.txt" dest="/home/ec2-user/ansible/hosts/ansible_hosts" force="yes" owner="ec2-user" group="ec2-user" mode="0400"      
#    - copy: src="./hosts/ec2.ini" dest="/home/ec2-user/ansible/" force="yes" owner="ec2-user" group="ec2-user" mode="0400"      
#    - copy: src="./hosts/ec2.py" dest="/home/ec2-user/ansible/" force="yes" owner="ec2-user" group="ec2-user" mode="0700"      
    - copy: src="./ansible.cfg" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"    
    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export AWS_ACCESS_KEY{{'='}}{{ec2_access_key}}"        
    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export AWS_SECRET_KEY{{'='}}{{ec2_secret_key}}"   
    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export ANSIBLE_HOSTS=/home/ec2-user/ansible/hosts"         
    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export EC2_INI_PATH=/home/ec2-user/ansible/hosts/ec2.ini"
#    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export EC2_URL=https://ec2.us-east-1.amazonaws.com"
    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export ANSIBLE_CONFIG=/home/ec2-user/ansible/ansible.cfg"
#    - lineinfile: dest=/home/ec2-user/.bash_profile state=present line="export EC2_HOME=/opt/aws/apitools/ec2"
    - copy: src="./tsr_ec2_create_topology.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_delete_topology.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_conf_vols.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_conf_prereq.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_conf_jboss.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_conf_zk.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_conf_zk_overlay.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_conf_tsr.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_startall.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_startnode.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_startzknode.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_startzkovnode.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_startzkall.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_services_startall.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_services_startnode.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_services_stopnode.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_services_configuration.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_addSampleData_nodes.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_configure.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_staticip_bootstrap.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./configureAllNodes.sh" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./tsr_ec2_ansible.yml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
#    - copy: src="./PlaybookSequence.txt" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./lib" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./modules" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./LocalNodeProperties_master.config" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644" 
    - copy: src="./configureMasterSchemaEC2MultiRegion.cql" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./standalone-teiid_master.xml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./TIMESERIES-vdb_master.xml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./TimeSeriesH2Script.sql" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./lib" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./seeds.py" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./zoo_master.cfg" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./zoo.cfg.dynamic" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./zoo_master_overlay.cfg" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./zoo.cfg.dynamic.overlay" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./myid" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./log4j-server_master.properties" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./log4j_tasks_master.properties" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./TIMESERIES-vdb_master.xml" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./boto_master.txt" dest="/home/ec2-user/.boto" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./log4j.properties" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./squiggleejobs.jar" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./squiggleeclient.jar" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./jdk-7u67-linux-x64.rpm" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0744"
#    - copy: src="./jdk-8u60-linux-x64.rpm" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0744"
    - copy: src="./teiid-8.3.0.Final-jboss-dist.zip" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./jboss-as-7.1.1.Final.zip" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
#    - copy: src="./apache-cassandra-2.1.2-bin.tar.gz" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
#    - copy: src="./zookeeper-3.4.6.tar.zip" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
    - copy: src="./zookeeper-3.5.0-alpha.tar.gz" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"
#    - copy: src="./apache-cassandra-2.0.9-bin.tar.gz" dest="/home/ec2-user/ansible" force="yes" owner="ec2-user" group="ec2-user" mode="0644"